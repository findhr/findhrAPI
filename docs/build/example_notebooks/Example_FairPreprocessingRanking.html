
<!DOCTYPE html>

<html class="writer-html5" data-content_root="../" lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Fair Preprocessing Ranking — findhrAPI 1.0.0 documentation</title>
<link href="../_static/pygments.css?v=b86133f3" rel="stylesheet" type="text/css"/>
<link href="../_static/css/theme.css?v=e59714d7" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=b2176991" rel="stylesheet" type="text/css"/>
<link href="../_static/nbsphinx-code-cells.css?v=2aa19091" rel="stylesheet" type="text/css"/>
<script src="../_static/jquery.js?v=5d32c60e"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
<script src="../_static/documentation_options.js?v=f9c1cefe"></script>
<script src="../_static/doctools.js?v=9a2dae69"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
<script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../_static/js/theme.js"></script>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../index.html">
            findhrAPI
          </a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_data_format.html">Input Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess.html">Feature Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fairness.html">Fairness Intervention for Fair Rankings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Fairness Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xai.html">eXplainable AI (XAI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../index.html">findhrAPI</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Home" class="icon icon-home" href="../index.html"></a></li>
<li class="breadcrumb-item active">Fair Preprocessing Ranking</li>
<li class="wy-breadcrumbs-aside">
<a href="../_sources/example_notebooks/Example_FairPreprocessingRanking.ipynb" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<section id="Fair-Preprocessing-Ranking">
<h1>Fair Preprocessing Ranking<a class="headerlink" href="#Fair-Preprocessing-Ranking" title="Link to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#module-findhr.preprocess.mapping" title="findhr.preprocess.mapping"><span class="nn">findhr.preprocess.mapping</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.AttachMetadata" title="findhr.preprocess.mapping.AttachMetadata"><span class="n">AttachMetadata</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DerivedColumn" title="findhr.preprocess.mapping.DerivedColumn"><span class="n">DerivedColumn</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DetachMetadata" title="findhr.preprocess.mapping.DetachMetadata"><span class="n">DetachMetadata</span></a>
<span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#module-findhr.preprocess.example_mappings" title="findhr.preprocess.example_mappings"><span class="nn">findhr.preprocess.example_mappings</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.RelevantExperienceForRole" title="findhr.preprocess.example_mappings.RelevantExperienceForRole"><span class="n">RelevantExperienceForRole</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.ExtractMonthDurationJob" title="findhr.preprocess.example_mappings.ExtractMonthDurationJob"><span class="n">ExtractMonthDurationJob</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchOrdinal" title="findhr.preprocess.example_mappings.MatchOrdinal"><span class="n">MatchOrdinal</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.ExtractListOfProperty" title="findhr.preprocess.example_mappings.ExtractListOfProperty"><span class="n">ExtractListOfProperty</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchFeatureAtLeastInList" title="findhr.preprocess.example_mappings.MatchFeatureAtLeastInList"><span class="n">MatchFeatureAtLeastInList</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchFeatureSet" title="findhr.preprocess.example_mappings.MatchFeatureSet"><span class="n">MatchFeatureSet</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchBinary" title="findhr.preprocess.example_mappings.MatchBinary"><span class="n">MatchBinary</span></a>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_iFair.html#module-findhr.fairness.fairness_method_iFair" title="findhr.fairness.fairness_method_iFair"><span class="nn">findhr.fairness.fairness_method_iFair</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_iFair.html#findhr.fairness.fairness_method_iFair.iFair" title="findhr.fairness.fairness_method_iFair.iFair"><span class="n">iFair</span></a>
<span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_gFair.html#module-findhr.fairness.fairness_method_gFair" title="findhr.fairness.fairness_method_gFair"><span class="nn">findhr.fairness.fairness_method_gFair</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_gFair.html#findhr.fairness.fairness_method_gFair.gFair" title="findhr.fairness.fairness_method_gFair.gFair"><span class="n">gFair</span></a>
<span class="kn">from</span><span class="w"> </span><a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#module-findhr.fairness.fairness_method_LFR" title="findhr.fairness.fairness_method_LFR"><span class="nn">findhr.fairness.fairness_method_LFR</span></a><span class="w"> </span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR" title="findhr.fairness.fairness_method_LFR.LFR"><span class="n">LFR</span></a>
<span class="kn">from</span><span class="w"> </span><span class="nn">findhr.fairness.utils.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_ranking</span>
</pre></div>
</div>
</div>
<section id="Data">
<h2><strong>Data</strong><a class="headerlink" href="#Data" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">query_col</span><span class="p">,</span> <span class="n">id_col</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="p">,</span> <span class="n">sort_col</span><span class="p">,</span> <span class="n">pos_th</span><span class="p">,</span> <span class="n">return_ratio</span><span class="p">,</span> <span class="n">out_path</span><span class="p">):</span>

    <span class="c1"># create a column to represent the intersectional values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sensitive_col</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sensitive_col_intersectional</span> <span class="o">=</span> <span class="s2">"_"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitive_col</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sensitive_col</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">+=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">sensitive_col_intersectional</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">sensitive_col</span> <span class="o">=</span> <span class="n">sensitive_col_intersectional</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"train_data.csv"</span><span class="p">)):</span>
        <span class="c1"># splitting the dataset into training and testing sets</span>
        <span class="n">train_samples</span><span class="p">,</span> <span class="n">test_samples</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qid</span><span class="p">,</span> <span class="n">df_query</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">query_col</span><span class="p">):</span>
            <span class="n">pos_samples</span> <span class="o">=</span> <span class="n">df_query</span><span class="p">[</span><span class="n">df_query</span><span class="p">[</span><span class="n">sort_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pos_th</span><span class="p">]</span>  <span class="c1"># Positive samples</span>
            <span class="n">neg_samples</span> <span class="o">=</span> <span class="n">df_query</span><span class="p">[</span><span class="n">df_query</span><span class="p">[</span><span class="n">sort_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pos_th</span><span class="p">]</span>  <span class="c1"># Negative samples</span>

            <span class="c1"># identify groups with insufficient samples</span>
            <span class="n">group_sizes</span> <span class="o">=</span> <span class="n">pos_samples</span><span class="p">[</span><span class="n">sensitive_col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
            <span class="n">insufficient_groups</span> <span class="o">=</span> <span class="n">group_sizes</span><span class="p">[</span><span class="n">group_sizes</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">insufficient_groups</span><span class="p">:</span>
                <span class="n">drop_qid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qid</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"QID </span><span class="si">{</span><span class="n">qid</span><span class="si">}</span><span class="s2"> does not have enough samples"</span><span class="p">)</span>
                <span class="k">continue</span>  <span class="c1"># skip this query group if it has insufficient data</span>

            <span class="c1"># perform stratified sampling</span>
            <span class="n">stratified_pos_sample</span> <span class="o">=</span> <span class="n">pos_samples</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sensitive_col</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">return_ratio</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
            <span class="n">stratified_neg_sample</span> <span class="o">=</span> <span class="n">neg_samples</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sensitive_col</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">return_ratio</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>

            <span class="n">train_samples</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stratified_pos_sample</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">train_samples</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stratified_neg_sample</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="n">test_samples</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">df_query</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df_query</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_samples</span><span class="p">),</span> <span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">df_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_samples</span><span class="p">)]</span>
        <span class="n">df_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_samples</span><span class="p">)]</span>

        <span class="n">df_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"train_data.csv"</span><span class="p">))</span>
        <span class="n">df_test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"test_data.csv"</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"train_data.csv"</span><span class="p">))</span>
        <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"test_data.csv"</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df_train</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
              <span class="n">df_train</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
              <span class="n">df_test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
              <span class="n">df_train</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
              <span class="n">df_test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span>
<br/></pre></div>
</div>
</div>
<p>Run the Input Data Sources notebook to get the input data in the format required with the required metadata information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> Example_InputDataSources.ipynb
</pre></div>
</div>
</div>
<p>Metadata information</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">md_all</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{'id_c':
        SCHEMA = {'type': 'number'}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'education_background_c':
        SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'degree': {'type': 'string'}, 'duration': {'type': 'string'}}}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'professional_experience_c':
        SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'role': {'type': 'string'}, 'duration': {'type': 'string'}}}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'skills_c':
        SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'gender_c':
        SCHEMA = {'enum': ['Man', 'Woman', 'Any']}
        ATTR_TYPE = category
        ATTR_USAGE = sensitive
        KNOWLEDGE_BASE = None,
 'agg_perceived_foreign_c':
        SCHEMA = {'enum': ['No', 'Yes', 'Any']}
        ATTR_TYPE = category
        ATTR_USAGE = sensitive
        KNOWLEDGE_BASE = None,
 'id_j':
        SCHEMA = {'type': 'number'}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'education_reqs_j':
        SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'experience_reqs_role_j':
        SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'experience_reqs_duration_j':
        SCHEMA = {'type': 'number'}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'skills_j':
        SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
        ATTR_TYPE = object
        ATTR_USAGE = default
        KNOWLEDGE_BASE = None,
 'gender_j':
        SCHEMA = {'enum': ['Man', 'Woman', 'Any']}
        ATTR_TYPE = category
        ATTR_USAGE = sensitive
        KNOWLEDGE_BASE = None,
 'agg_perceived_foreign_j':
        SCHEMA = {'enum': ['No', 'Yes', 'Any']}
        ATTR_TYPE = category
        ATTR_USAGE = sensitive
        KNOWLEDGE_BASE = None,
 'score':
        SCHEMA = {'type': 'number'}
        ATTR_TYPE = numeric
        ATTR_USAGE = target
        KNOWLEDGE_BASE = None,
 'ranking':
        SCHEMA = {'type': 'integer'}
        ATTR_TYPE = ordinal
        ATTR_USAGE = target
        KNOWLEDGE_BASE = None,
 'shortlisted':
        SCHEMA = {'type': 'integer'}
        ATTR_TYPE = category
        ATTR_USAGE = target
        KNOWLEDGE_BASE = None}
</pre></div></div>
</div>
<p>Input data formatted as a pandas dataframe</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_all</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>id_c</th>
<th>education_background_c</th>
<th>professional_experience_c</th>
<th>skills_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>id_j</th>
<th>education_reqs_j</th>
<th>experience_reqs_role_j</th>
<th>experience_reqs_duration_j</th>
<th>skills_j</th>
<th>gender_j</th>
<th>agg_perceived_foreign_j</th>
<th>ranking</th>
<th>shortlisted</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>5</td>
<td>[{'institution': 'Complutense University Of Ma...</td>
<td>[{'institution': 'Stylo Milano', 'start_date':...</td>
<td>[Communications, Social Integration, Microsoft...</td>
<td>Man</td>
<td>No</td>
<td>5</td>
<td>[Law Bachelor, Degree In Law, Higher Degree In...</td>
<td>[Consultant]</td>
<td>12</td>
<td>[Punctuality, Organization, Accounting, Englis...</td>
<td>Man</td>
<td>No</td>
<td>4</td>
<td>1</td>
<td>0.0</td>
</tr>
<tr>
<th>1</th>
<td>6</td>
<td>[{'institution': 'Coronel Rosales Agricultural...</td>
<td>[{'institution': 'Securitas Direct', 'start_da...</td>
<td>[Refinancing, Economy, Microsoft Excel, Collec...</td>
<td>Man</td>
<td>No</td>
<td>3</td>
<td>[]</td>
<td>[Sales Assistant, Saleswoman, Commercial Advisor]</td>
<td>12</td>
<td>[English, Spanish, Communications, Communicati...</td>
<td>Man</td>
<td>No</td>
<td>8</td>
<td>1</td>
<td>0.6</td>
</tr>
<tr>
<th>2</th>
<td>10</td>
<td>[{'institution': 'Complutense University Of Ma...</td>
<td>[{'institution': 'Carrefour Express', 'start_d...</td>
<td>[Entrepreneurship, Literacy, Web Design, Adobe...</td>
<td>Woman</td>
<td>No</td>
<td>5</td>
<td>[Law Bachelor, Degree In Law, Higher Degree In...</td>
<td>[Consultant]</td>
<td>12</td>
<td>[Punctuality, Organization, Accounting, Englis...</td>
<td>Man</td>
<td>No</td>
<td>4</td>
<td>1</td>
<td>0.0</td>
</tr>
<tr>
<th>3</th>
<td>11</td>
<td>[{'institution': 'Les Ribera De Los Molinos', ...</td>
<td>[{'institution': 'Decimas Sl', 'start_date': '...</td>
<td>[Consulting, Sap Crm, Collections, Automation,...</td>
<td>Woman</td>
<td>No</td>
<td>3</td>
<td>[]</td>
<td>[Sales Assistant, Saleswoman, Commercial Advisor]</td>
<td>12</td>
<td>[English, Spanish, Communications, Communicati...</td>
<td>Man</td>
<td>No</td>
<td>12</td>
<td>0</td>
<td>0.4</td>
</tr>
<tr>
<th>4</th>
<td>15</td>
<td>[{'institution': 'Escuela Politcnica Superior ...</td>
<td>[{'institution': 'Reintegrate', 'start_date': ...</td>
<td>[Microsoft Word, Biofuels, English, Entreprene...</td>
<td>Man</td>
<td>No</td>
<td>3</td>
<td>[]</td>
<td>[Sales Assistant, Saleswoman, Commercial Advisor]</td>
<td>12</td>
<td>[English, Spanish, Communications, Communicati...</td>
<td>Man</td>
<td>No</td>
<td>5</td>
<td>1</td>
<td>0.7</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>Define the preprocessing steps</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting category columns in DataFrame</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">md_all</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">attr_type</span><span class="o">==</span><span class="s1">'category'</span><span class="p">]</span>
<span class="n">df_all</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'category'</span><span class="p">)</span>
<span class="n">df_all</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1643 entries, 0 to 1642
Data columns (total 16 columns):
 #   Column                      Non-Null Count  Dtype
---  ------                      --------------  -----
 0   id_c                        1643 non-null   int64
 1   education_background_c      1643 non-null   object
 2   professional_experience_c   1643 non-null   object
 3   skills_c                    1643 non-null   object
 4   gender_c                    1643 non-null   category
 5   agg_perceived_foreign_c     1643 non-null   category
 6   id_j                        1643 non-null   int64
 7   education_reqs_j            1643 non-null   object
 8   experience_reqs_role_j      1643 non-null   object
 9   experience_reqs_duration_j  1643 non-null   int64
 10  skills_j                    1643 non-null   object
 11  gender_j                    1643 non-null   category
 12  agg_perceived_foreign_j     1643 non-null   category
 13  ranking                     1643 non-null   int64
 14  shortlisted                 1643 non-null   category
 15  score                       1643 non-null   float64
dtypes: category(5), float64(1), int64(4), object(6)
memory usage: 149.9+ KB
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define ids, target feature(s), and predictive features.</span>
<span class="n">id_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id_c'</span><span class="p">,</span> <span class="s1">'id_j'</span><span class="p">]</span>
<span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'score'</span><span class="p">,</span> <span class="s1">'ranking'</span><span class="p">,</span> <span class="s1">'shortlisted'</span><span class="p">]</span>
<span class="n">pred_cols</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">target_cols</span> <span class="o">+</span> <span class="n">id_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract features from the data</span>
<span class="n">maps_derived_1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">((</span><span class="s1">'professional_experience_c'</span><span class="p">,</span> <span class="s1">'experience_reqs_role_j'</span><span class="p">,),</span> <span class="p">(</span><span class="s1">'relevant_exp_role_c'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.RelevantExperienceForRole" title="findhr.preprocess.example_mappings.RelevantExperienceForRole"><span class="n">RelevantExperienceForRole</span></a><span class="p">(),</span>
<span class="p">}</span>

<span class="n">maps_derived_2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">((</span><span class="s1">'relevant_exp_role_c'</span><span class="p">,),</span> <span class="p">(</span><span class="s1">'role_duration_months_c'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.ExtractMonthDurationJob" title="findhr.preprocess.example_mappings.ExtractMonthDurationJob"><span class="n">ExtractMonthDurationJob</span></a><span class="p">(</span><span class="n">duration_key</span><span class="o">=</span><span class="s1">'duration_months'</span><span class="p">),</span>
        <span class="p">((</span><span class="s1">'education_background_c'</span><span class="p">,),</span> <span class="p">(</span><span class="s1">'degree_list_c'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.ExtractListOfProperty" title="findhr.preprocess.example_mappings.ExtractListOfProperty"><span class="n">ExtractListOfProperty</span></a><span class="p">(</span><span class="n">property_key</span><span class="o">=</span><span class="s1">'degree'</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Fitness features about the matching between candidate's features and job's requirements.</span>
<span class="n">maps_matching</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">((</span><span class="s1">'experience_reqs_duration_j'</span><span class="p">,</span> <span class="s1">'role_duration_months_c'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fitness_experience'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchOrdinal" title="findhr.preprocess.example_mappings.MatchOrdinal"><span class="n">MatchOrdinal</span></a><span class="p">(),</span>
    <span class="p">((</span><span class="s1">'education_reqs_j'</span><span class="p">,</span> <span class="s1">'education_background_c'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fitness_education'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchFeatureAtLeastInList" title="findhr.preprocess.example_mappings.MatchFeatureAtLeastInList"><span class="n">MatchFeatureAtLeastInList</span></a><span class="p">(),</span>
    <span class="p">((</span><span class="s1">'skills_j'</span><span class="p">,</span> <span class="s1">'skills_c'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fitness_skills'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchFeatureSet" title="findhr.preprocess.example_mappings.MatchFeatureSet"><span class="n">MatchFeatureSet</span></a><span class="p">(),</span>
    <span class="p">((</span><span class="s1">'gender_j'</span><span class="p">,</span> <span class="s1">'gender_c'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fitness_gender'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchBinary" title="findhr.preprocess.example_mappings.MatchBinary"><span class="n">MatchBinary</span></a><span class="p">(),</span>
    <span class="p">((</span><span class="s1">'agg_perceived_foreign_j'</span><span class="p">,</span> <span class="s1">'agg_perceived_foreign_c'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'fitness_foreign'</span><span class="p">,)):</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.example_mappings.html#findhr.preprocess.example_mappings.MatchBinary" title="findhr.preprocess.example_mappings.MatchBinary"><span class="n">MatchBinary</span></a><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the preprocessor for numeric features: imputing and scaling numeric features</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"imputer"</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">"median"</span><span class="p">)),</span> <span class="c1"># Not needed for the used dataset.</span>
        <span class="p">(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span> <span class="c1"># Not needed for the decision tree, let's keep it for the sake of generality.</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 0: define column preprocessing only for the regressor without the fairness intervention in the pipeline</span>
<span class="n">numeric_features_reg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fitness_experience'</span><span class="p">,</span> <span class="s1">'fitness_education'</span><span class="p">,</span> <span class="s1">'fitness_skills'</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">]</span>

<span class="n">column_preprocessor_regressor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"num"</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features_reg</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: preprocessing the input for the fairness intervention</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fitness_experience'</span><span class="p">,</span> <span class="s1">'fitness_education'</span><span class="p">,</span> <span class="s1">'fitness_skills'</span><span class="p">,</span> <span class="s1">'score'</span><span class="p">]</span>

<span class="n">column_preprocessor_numerical_pandas</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"num"</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">)</span>

    <span class="p">],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">'passthrough'</span><span class="p">,</span> <span class="c1"># return all columns not only the preprocessed ones</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">"pandas"</span><span class="p">)</span> <span class="c1"># input to the fairness intervention needs to be a pandas dataframe</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 2: preprocessing the output of the fairness intervention to be used by the regressor (_fair columns contain the fairer data representation)</span>
<span class="n">numeric_features_out</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fitness_experience_fair'</span><span class="p">,</span> <span class="s1">'fitness_education_fair'</span><span class="p">,</span> <span class="s1">'fitness_skills_fair'</span><span class="p">,</span> <span class="s1">'score_fair'</span><span class="p">]</span>

<span class="c1"># return only columns to be used as training features/labels by the regressor</span>
<span class="n">column_preprocessor_fair_regressor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"num"</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features_out</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 3: define the columns to be pre-processed by the fairness interventions</span>
<span class="c1"># this example will run using both sensitive attributes available in the data: 'gender_c' and 'agg_perceived_foreign_c'</span>

<span class="n">query_col_data</span> <span class="o">=</span> <span class="s1">'id_j'</span>
<span class="n">candidate_id</span> <span class="o">=</span> <span class="s1">'id_c'</span>
<span class="n">features_col_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fitness_experience'</span><span class="p">,</span> <span class="s1">'fitness_education'</span><span class="p">,</span> <span class="s1">'fitness_skills'</span><span class="p">]</span>
<span class="n">score_col_data</span> <span class="o">=</span> <span class="s1">'score'</span>
<span class="n">sensitive_col_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gender_c'</span><span class="p">,</span> <span class="s1">'agg_perceived_foreign_c'</span><span class="p">]</span>
<span class="n">intersectional_col_data</span> <span class="o">=</span> <span class="s2">"_"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitive_col_data</span><span class="p">)</span>
<span class="n">columns_display_regressor</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">candidate_id</span><span class="p">,</span> <span class="s2">"prediction"</span><span class="p">,</span> <span class="n">intersectional_col_data</span><span class="p">]</span> <span class="o">+</span> <span class="n">sensitive_col_data</span> <span class="o">+</span> <span class="n">numeric_features</span>
<span class="n">columns_display_fairness</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">candidate_id</span><span class="p">,</span> <span class="s2">"prediction"</span><span class="p">,</span> <span class="n">intersectional_col_data</span><span class="p">]</span> <span class="o">+</span> <span class="n">sensitive_col_data</span> <span class="o">+</span> <span class="n">numeric_features_out</span>

<span class="c1"># define the threshold for considering negative candidates (score with less than pos_th is considered as negative candidate)</span>
<span class="n">pos_th</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># define the output path to save the model and the fairer representation of the candidates</span>
<span class="n">out_path</span> <span class="o">=</span> <span class="s1">'../../../data/fairness_output/'</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the pipeline for data preprocessing with metadata (using findhr package)</span>
<span class="n">pipeline_derived</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">"init"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.AttachMetadata" title="findhr.preprocess.mapping.AttachMetadata"><span class="n">AttachMetadata</span></a><span class="p">(</span><span class="n">md_all</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">'mapping_1'</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DerivedColumn" title="findhr.preprocess.mapping.DerivedColumn"><span class="n">DerivedColumn</span></a><span class="p">(</span><span class="n">maps_derived_1</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">'mapping_2'</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DerivedColumn" title="findhr.preprocess.mapping.DerivedColumn"><span class="n">DerivedColumn</span></a><span class="p">(</span><span class="n">maps_derived_2</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">"matching"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DerivedColumn" title="findhr.preprocess.mapping.DerivedColumn"><span class="n">DerivedColumn</span></a><span class="p">(</span><span class="n">maps_matching</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">"end"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.preprocess.mapping.html#findhr.preprocess.mapping.DetachMetadata" title="findhr.preprocess.mapping.DetachMetadata"><span class="n">DetachMetadata</span></a><span class="p">())</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<p><strong>Create train-test split to train the fairness pre-processing intervention</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a stratified train-test split for each job (query_col_data) between negative and positive samples given all sensitive attributes (features_col_data) from the data and save in out_path</span>
<span class="n">df_all_train</span><span class="p">,</span> <span class="n">df_all_test</span> <span class="o">=</span> <span class="n">create_train_test_split</span><span class="p">(</span><span class="n">df_all</span><span class="p">,</span> <span class="n">query_col_data</span><span class="p">,</span> <span class="n">candidate_id</span><span class="p">,</span> <span class="n">sensitive_col_data</span><span class="p">,</span> <span class="n">score_col_data</span><span class="p">,</span> <span class="n">pos_th</span><span class="p">,</span> <span class="n">return_ratio</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Train-Regressor-without-Fairness-Intervention">
<h2><strong>Train Regressor without Fairness Intervention</strong><a class="headerlink" href="#Train-Regressor-without-Fairness-Intervention" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_regr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">'fitness_value'</span><span class="p">,</span> <span class="n">pipeline_derived</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"column_preprocessor"</span><span class="p">,</span> <span class="n">column_preprocessor_regressor</span><span class="p">),</span> <span class="c1"># second phase: preprocessing without metadata (standard scikit-learn)</span>
        <span class="p">(</span><span class="s2">"regressor"</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># model inference</span>
       <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the pipeline</span>
<span class="n">pipeline_regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">,</span> <span class="n">df_all_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'score'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-1"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
    KNOWLEDGE_BASE = None},
                                                                                                                           output_cols=('fitness_skills',))})),
                                 ('end', DetachMetadata())])),
                ('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience',
                                                   'fitness_education',
                                                   'fitness_skills',
                                                   'score'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-1"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
    KNOWLEDGE_BASE = None},
                                                                                                                           output_cols=('fitness_skills',))})),
                                 ('end', DetachMetadata())])),
                ('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience',
                                                   'fitness_education',
                                                   'fitness_skills',
                                                   'score'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-2"><div><div>fitness_value: Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for fitness_value: Pipeline</span></a></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('init',
                 AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'ty...
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                      output_cols=('fitness_gender',)),
                                         (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                                      'skills_c'),
                                                                                                          metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                          output_cols=('fitness_skills',))})),
                ('end', DetachMetadata())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-3"><div><div>AttachMetadata</div></div></label><div class="sk-toggleable__content fitted"><pre>AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties...
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'shortlisted':
    SCHEMA = {'type': 'integer'}
    ATTR_TYPE = category
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'skills_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                              'skills_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-4"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content fitted"><pre>DerivedColumn(mappings={(('professional_experience_c', 'experience_reqs_role_j'), ('relevant_exp_role_c',)): RelevantExperienceForRole(input_cols=('professional_experience_c',
                                                                                                                                                   'experience_reqs_role_j'),
                                                                                                                                       metadata_dict={'relevant_exp_role_c': {'experience_reqs_role_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                                                                                                                                                                              'professional_experience_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'role': {'type': 'string'}, 'duration': {'type': 'string'}}}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None}},
                                                                                                                                       output_cols=('relevant_exp_role_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-5"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content fitted"><pre>DerivedColumn(mappings={(('education_background_c',), ('degree_list_c',)): ExtractListOfProperty(input_cols=('education_background_c',),
                                                                                                 metadata_dict={'degree_list_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                 output_cols=('degree_list_c',)),
                        (('relevant_exp_role_c',), ('role_duration_months_c',)): ExtractMonthDurationJob(input_cols=('relevant_exp_role_c',),
                                                                                                         metadata_dict={'role_duration_months_c':
    SCHEMA = {'type': 'number', 'minimum': 0}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                         output_cols=('role_duration_months_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-6"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content fitted"><pre>DerivedColumn(mappings={(('agg_perceived_foreign_j', 'agg_perceived_foreign_c'), ('fitness_foreign',)): MatchBinary(input_cols=('agg_perceived_foreign_j',
                                                                                                                                'agg_perceived_foreign_c'),
                                                                                                                    metadata_dict={'fitness_foreign':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                                    output_cols=('fitness_foreign',)),
                        (('education_reqs_j', 'edu...
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                     output_cols=('fitness_gender',)),
                        (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                     'skills_c'),
                                                                                         metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                         output_cols=('fitness_skills',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-7"><div><div>DetachMetadata</div></div></label><div class="sk-toggleable__content fitted"><pre>DetachMetadata()</pre></div> </div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-8"><div><div>column_preprocessor: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience', 'fitness_education',
                                  'fitness_skills', 'score'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-9"><div><div>num</div></div></label><div class="sk-toggleable__content fitted"><pre>['fitness_experience', 'fitness_education', 'fitness_skills', 'score']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-10"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-11"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-12"><div><div>DecisionTreeRegressor</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeRegressor.html" rel="noreferrer" target="_blank">?<span>Documentation for DecisionTreeRegressor</span></a></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeRegressor(max_depth=3)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get predictions of regressor</span>
<span class="n">df_all_test</span><span class="p">[</span><span class="s1">'prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_all_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_display_regressor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['id_j',
 'id_c',
 'prediction',
 'gender_c_agg_perceived_foreign_c',
 'gender_c',
 'agg_perceived_foreign_c',
 'fitness_experience',
 'fitness_education',
 'fitness_skills',
 'score']
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display ranked list</span>
<span class="n">ranking_original</span> <span class="o">=</span> <span class="n">generate_ranking</span><span class="p">(</span><span class="n">df_all_test</span><span class="p">[</span><span class="n">columns_display_regressor</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"regressor_ranking.csv"</span><span class="p">))</span>
<span class="n">ranking_original</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Unnamed: 0</th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2164</td>
<td>0.777640</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.782609</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1</td>
<td>1</td>
<td>584</td>
<td>0.777640</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>0</td>
<td>0</td>
<td>0.3</td>
<td>0.713043</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>2</td>
<td>1</td>
<td>607</td>
<td>0.777640</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.2</td>
<td>0.782609</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1</td>
<td>2115</td>
<td>0.777640</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.4</td>
<td>0.782609</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>4</td>
<td>1</td>
<td>657</td>
<td>0.777640</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.2</td>
<td>0.782609</td>
<td>5</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>1017</th>
<td>1017</td>
<td>5</td>
<td>1144</td>
<td>0.007809</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.2</td>
<td>0.000000</td>
<td>94</td>
</tr>
<tr>
<th>1018</th>
<td>1018</td>
<td>5</td>
<td>1668</td>
<td>0.007809</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.2</td>
<td>0.026756</td>
<td>95</td>
</tr>
<tr>
<th>1019</th>
<td>1019</td>
<td>5</td>
<td>68</td>
<td>0.007809</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.000000</td>
<td>96</td>
</tr>
<tr>
<th>1020</th>
<td>1020</td>
<td>5</td>
<td>292</td>
<td>0.007809</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.024845</td>
<td>97</td>
</tr>
<tr>
<th>1021</th>
<td>1021</td>
<td>5</td>
<td>54</td>
<td>0.007809</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.000000</td>
<td>98</td>
</tr>
</tbody>
</table>
<p>1022 rows × 12 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display top-10 candidates from the ranked list for an example job title</span>
<span class="n">job_id</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">df_all_test_job</span> <span class="o">=</span> <span class="n">df_all_test</span><span class="p">[</span><span class="n">df_all_test</span><span class="p">[</span><span class="n">query_col_data</span><span class="p">]</span> <span class="o">==</span> <span class="n">job_id</span><span class="p">]</span>
<span class="n">generate_ranking</span><span class="p">(</span><span class="n">df_all_test_job</span><span class="p">[</span><span class="n">columns_display_regressor</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>148</td>
<td>0.777640</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.125</td>
<td>0.782609</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>3</td>
<td>1571</td>
<td>0.777640</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.000</td>
<td>0.782609</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>2047</td>
<td>0.632497</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>1</td>
<td>1</td>
<td>0.125</td>
<td>0.608696</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1472</td>
<td>0.632497</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>1</td>
<td>0.000</td>
<td>0.608696</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>3</td>
<td>1108</td>
<td>0.632497</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.000</td>
<td>0.695652</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>3</td>
<td>1092</td>
<td>0.632497</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.125</td>
<td>0.608696</td>
<td>6</td>
</tr>
<tr>
<th>6</th>
<td>3</td>
<td>963</td>
<td>0.632497</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.250</td>
<td>0.683230</td>
<td>7</td>
</tr>
<tr>
<th>7</th>
<td>3</td>
<td>1542</td>
<td>0.632497</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0</td>
<td>1</td>
<td>0.500</td>
<td>0.633540</td>
<td>8</td>
</tr>
<tr>
<th>8</th>
<td>3</td>
<td>1749</td>
<td>0.632497</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0</td>
<td>1</td>
<td>0.000</td>
<td>0.652174</td>
<td>9</td>
</tr>
<tr>
<th>9</th>
<td>3</td>
<td>1104</td>
<td>0.529795</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1</td>
<td>1</td>
<td>0.125</td>
<td>0.504348</td>
<td>10</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="Applying-Fairness-Pre-processing-Intervention">
<h2><strong>Applying Fairness Pre-processing Intervention</strong><a class="headerlink" href="#Applying-Fairness-Pre-processing-Intervention" title="Link to this heading"></a></h2>
<p><strong>LFR Pipeline</strong></p>
<p>Apply the LFR fair pre-processing intervention. LFR aims at achieving both group and individual fairness by creating representations that obfuscate information about the protected groups, while also ensuring a good encoding of useful information (which aims at preserving the utility of the ranking).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the optimisation type</span>
<span class="c1"># This example is run using the pairwise optimisation</span>
<span class="c1"># optimisation_type = {"pairwise": "all"} # pairwise comparison between all intersectional groups during the optimisation</span>
<span class="c1"># optimisation_type = {"independent": "all"} # the default value, which optimizes for each sensitive attribute independently</span>
<span class="c1"># optimisation_type = {"control": "ManNo"} # compares during the optimisation with the specified control value</span>
<span class="n">optimisation_type</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"extremes"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"ManNo"</span><span class="p">,</span> <span class="s2">"WomanYes"</span><span class="p">]}</span> <span class="c1"># compares during the optimisation only the defined values</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the parameters of the pre-processing fairness intervention model</span>
<a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR" title="findhr.fairness.fairness_method_LFR.LFR"><span class="n">fair_model</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR" title="findhr.fairness.fairness_method_LFR.LFR"><span class="n">LFR</span></a><span class="p">(</span><span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">features_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="n">score_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">sensitive_col_data</span><span class="p">,</span>
                                     <span class="n">optimisation_type</span><span class="o">=</span><span class="n">optimisation_type</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">A_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">A_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">A_z</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">model_occ</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos_th</span><span class="o">=</span><span class="n">pos_th</span><span class="p">,</span>  <span class="n">out_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if you don't want to use the scikit pipeline tu run the fairness pre-processing interventions you can do the following</span>
<a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR.fit" title="findhr.fairness.fairness_method_LFR.LFR.fit"><span class="n">fair_model</span><span class="o">.</span><span class="n">fit</span></a><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
<span class="n">df_all_fair_test</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR.transform" title="findhr.fairness.fairness_method_LFR.LFR.transform"><span class="n">fair_model</span><span class="o">.</span><span class="n">transform</span></a><span class="p">(</span><span class="n">df_all_test</span><span class="p">)</span>
<span class="n">df_all_fair_test</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Unnamed: 0.1</th>
<th>fitness_experience_fair</th>
<th>fitness_education_fair</th>
<th>fitness_skills_fair</th>
<th>score_fair</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>Unnamed: 0</th>
<th>...</th>
<th>agg_perceived_foreign_j</th>
<th>ranking</th>
<th>shortlisted</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>relevant_exp_role_c</th>
<th>role_duration_months_c</th>
<th>degree_list_c</th>
<th>fitness_gender</th>
<th>fitness_foreign</th>
<th>gender_c_agg_perceived_foreign_c_coded</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>-0.541418</td>
<td>-0.363636</td>
<td>-0.842891</td>
<td>-0.174706</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>0.138767</td>
<td>0</td>
<td>...</td>
<td>No</td>
<td>22</td>
<td>0</td>
<td>WomanNo</td>
<td>[]</td>
<td>0</td>
<td>['Degree In Law']</td>
<td>0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<th>1</th>
<td>1</td>
<td>-0.555659</td>
<td>-0.404366</td>
<td>-0.990753</td>
<td>-1.536733</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>-2.553073</td>
<td>3</td>
<td>...</td>
<td>No</td>
<td>61</td>
<td>0</td>
<td>WomanNo</td>
<td>[]</td>
<td>0</td>
<td>['Degree In Law']</td>
<td>0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<th>2</th>
<td>2</td>
<td>-0.573630</td>
<td>-0.409584</td>
<td>-0.989585</td>
<td>-1.383428</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>-2.367295</td>
<td>5</td>
<td>...</td>
<td>No</td>
<td>57</td>
<td>0</td>
<td>WomanNo</td>
<td>[]</td>
<td>0</td>
<td>['Degree In Law']</td>
<td>0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>-0.517737</td>
<td>-0.336506</td>
<td>-0.820644</td>
<td>-0.118504</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>0.362897</td>
<td>7</td>
<td>...</td>
<td>No</td>
<td>11</td>
<td>0</td>
<td>ManNo</td>
<td>[]</td>
<td>0</td>
<td>['Degree In Law']</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>4</th>
<td>4</td>
<td>-0.526421</td>
<td>-0.396442</td>
<td>-0.992105</td>
<td>-1.774917</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>-2.854962</td>
<td>9</td>
<td>...</td>
<td>No</td>
<td>72</td>
<td>0</td>
<td>WomanNo</td>
<td>[]</td>
<td>0</td>
<td>['Degree In Law']</td>
<td>0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>1017</th>
<td>264</td>
<td>-0.473579</td>
<td>-0.344687</td>
<td>-0.354433</td>
<td>0.235639</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-0.786081</td>
<td>0.490971</td>
<td>960</td>
<td>...</td>
<td>No</td>
<td>13</td>
<td>0</td>
<td>ManNo</td>
<td>[]</td>
<td>0</td>
<td>['Intermediate Degree In Administration']</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1018</th>
<td>265</td>
<td>-0.594684</td>
<td>-0.418461</td>
<td>-0.404528</td>
<td>0.103851</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-0.786081</td>
<td>-0.012177</td>
<td>963</td>
<td>...</td>
<td>No</td>
<td>82</td>
<td>0</td>
<td>ManNo</td>
<td>[]</td>
<td>0</td>
<td>['Intermediate Degree In Administration']</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>1019</th>
<td>266</td>
<td>-0.269048</td>
<td>0.007863</td>
<td>0.216667</td>
<td>0.339769</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>1.813952</td>
<td>-0.037334</td>
<td>966</td>
<td>...</td>
<td>No</td>
<td>87</td>
<td>0</td>
<td>ManYes</td>
<td>[]</td>
<td>0</td>
<td>['Graduated In Administration And Management C...</td>
<td>1</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<th>1020</th>
<td>267</td>
<td>-0.606968</td>
<td>-0.431743</td>
<td>-0.430678</td>
<td>0.107080</td>
<td>-0.351388</td>
<td>-0.245315</td>
<td>-1.219419</td>
<td>0.006691</td>
<td>968</td>
<td>...</td>
<td>No</td>
<td>80</td>
<td>0</td>
<td>WomanNo</td>
<td>[]</td>
<td>0</td>
<td>['Graduated In Administration And Management C...</td>
<td>0</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<th>1021</th>
<td>268</td>
<td>0.110219</td>
<td>0.279291</td>
<td>0.388704</td>
<td>0.476690</td>
<td>2.845857</td>
<td>-0.245315</td>
<td>1.813952</td>
<td>0.843174</td>
<td>1012</td>
<td>...</td>
<td>No</td>
<td>7</td>
<td>1</td>
<td>ManNo</td>
<td>[{'institution': 'Lime Systems', 'start_date':...</td>
<td>16</td>
<td>['Higher Computer Engineering']</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>1022 rows × 32 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define pipeline for the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">'fitness_value'</span><span class="p">,</span> <span class="n">pipeline_derived</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"column_preprocessor_numerical_pandas"</span><span class="p">,</span> <span class="n">column_preprocessor_numerical_pandas</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"fair_preprocessing"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_LFR.html#findhr.fairness.fairness_method_LFR.LFR" title="findhr.fairness.fairness_method_LFR.LFR"><span class="n">fair_model</span></a><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-2"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                     __class__=&lt;class 'findhr.fairness.fairness_method_LFR.LFR'&gt;,
                     feature_cols=['fitness_experience', 'fitness_education',
                                   'fitness_skills'],
                     k=10, model_occ=True, name='LFR',
                     optimisation_type={'extremes': ['ManNo', 'WomanYes']},
                     out_path='../../../data/fairness_output/', pos_th=0.1,
                     print_interval=1000, query_col='id_j', score_col='score',
                     sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                     verbose=True))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-13"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link">i<span>Not fitted</span></span></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                     __class__=&lt;class 'findhr.fairness.fairness_method_LFR.LFR'&gt;,
                     feature_cols=['fitness_experience', 'fitness_education',
                                   'fitness_skills'],
                     k=10, model_occ=True, name='LFR',
                     optimisation_type={'extremes': ['ManNo', 'WomanYes']},
                     out_path='../../../data/fairness_output/', pos_th=0.1,
                     print_interval=1000, query_col='id_j', score_col='score',
                     sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                     verbose=True))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-14"><div><div>fitness_value: Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for fitness_value: Pipeline</span></a></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('init',
                 AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'ty...
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                      output_cols=('fitness_gender',)),
                                         (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                                      'skills_c'),
                                                                                                          metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                          output_cols=('fitness_skills',))})),
                ('end', DetachMetadata())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-15"><div><div>AttachMetadata</div></div></label><div class="sk-toggleable__content"><pre>AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties...
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'shortlisted':
    SCHEMA = {'type': 'integer'}
    ATTR_TYPE = category
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'skills_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                              'skills_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-16"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('professional_experience_c', 'experience_reqs_role_j'), ('relevant_exp_role_c',)): RelevantExperienceForRole(input_cols=('professional_experience_c',
                                                                                                                                                   'experience_reqs_role_j'),
                                                                                                                                       metadata_dict={'relevant_exp_role_c': {'experience_reqs_role_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                                                                                                                                                                              'professional_experience_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'role': {'type': 'string'}, 'duration': {'type': 'string'}}}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None}},
                                                                                                                                       output_cols=('relevant_exp_role_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-17"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('education_background_c',), ('degree_list_c',)): ExtractListOfProperty(input_cols=('education_background_c',),
                                                                                                 metadata_dict={'degree_list_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                 output_cols=('degree_list_c',)),
                        (('relevant_exp_role_c',), ('role_duration_months_c',)): ExtractMonthDurationJob(input_cols=('relevant_exp_role_c',),
                                                                                                         metadata_dict={'role_duration_months_c':
    SCHEMA = {'type': 'number', 'minimum': 0}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                         output_cols=('role_duration_months_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-18"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('agg_perceived_foreign_j', 'agg_perceived_foreign_c'), ('fitness_foreign',)): MatchBinary(input_cols=('agg_perceived_foreign_j',
                                                                                                                                'agg_perceived_foreign_c'),
                                                                                                                    metadata_dict={'fitness_foreign':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                                    output_cols=('fitness_foreign',)),
                        (('education_reqs_j', 'edu...
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                     output_cols=('fitness_gender',)),
                        (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                     'skills_c'),
                                                                                         metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                         output_cols=('fitness_skills',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-19"><div><div>DetachMetadata</div></div></label><div class="sk-toggleable__content"><pre>DetachMetadata()</pre></div> </div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-20"><div><div>column_preprocessor_numerical_pandas: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor_numerical_pandas: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder='passthrough',
                  transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience', 'fitness_education',
                                  'fitness_skills', 'score'])],
                  verbose_feature_names_out=False)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-21"><div><div>num</div></div></label><div class="sk-toggleable__content"><pre>['fitness_experience', 'fitness_education', 'fitness_skills', 'score']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-22"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-23"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-24"><div><div>remainder</div></div></label><div class="sk-toggleable__content"><pre>['Unnamed: 0', 'id_c', 'education_background_c', 'professional_experience_c', 'skills_c', 'gender_c', 'agg_perceived_foreign_c', 'id_j', 'education_reqs_j', 'experience_reqs_role_j', 'experience_reqs_duration_j', 'skills_j', 'gender_j', 'agg_perceived_foreign_j', 'ranking', 'shortlisted', 'gender_c_agg_perceived_foreign_c', 'relevant_exp_role_c', 'role_duration_months_c', 'degree_list_c', 'fitness_gender', 'fitness_foreign']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-25"><div><div>passthrough</div></div></label><div class="sk-toggleable__content"><pre>passthrough</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-26"><div><div>LFR</div></div></label><div class="sk-toggleable__content"><pre>LFR(A_x=1, A_y=1, A_z=10,
    __class__=&lt;class 'findhr.fairness.fairness_method_LFR.LFR'&gt;,
    feature_cols=['fitness_experience', 'fitness_education', 'fitness_skills'],
    k=10, model_occ=True, name='LFR',
    optimisation_type={'extremes': ['ManNo', 'WomanYes']},
    out_path='../../../data/fairness_output/', pos_th=0.1, print_interval=1000,
    query_col='id_j', score_col='score',
    sensitive_col=['gender_c', 'agg_perceived_foreign_c'], verbose=True)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply transformation using the pre-processing fairness intervention model</span>
<span class="c1"># set the file_name if you want to save the data</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"train"</span>
<span class="n">transformed_data_train</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="n">transformed_data_test</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define regressor pipeline</span>
<span class="n">pipeline_regr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"column_preprocessor"</span><span class="p">,</span> <span class="n">column_preprocessor_fair_regressor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"regressor"</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
       <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the regressor</span>
<span class="n">pipeline_regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_data_train</span><span class="p">,</span> <span class="n">transformed_data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'score_fair'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-3"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-27"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-28"><div><div>column_preprocessor: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience_fair',
                                  'fitness_education_fair',
                                  'fitness_skills_fair', 'score_fair'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-29"><div><div>num</div></div></label><div class="sk-toggleable__content fitted"><pre>['fitness_experience_fair', 'fitness_education_fair', 'fitness_skills_fair', 'score_fair']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-30"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-31"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-32"><div><div>DecisionTreeRegressor</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeRegressor.html" rel="noreferrer" target="_blank">?<span>Documentation for DecisionTreeRegressor</span></a></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeRegressor(max_depth=3)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get predictions of regressor</span>
<span class="n">transformed_data_test</span><span class="p">[</span><span class="s1">'prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the generated ranking and the output of the fairness intervention (columns with "_fair")</span>
<span class="n">ranking_lfr</span> <span class="o">=</span> <span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">columns_display_fairness</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"LFR"</span><span class="p">,</span><span class="s2">"LFR_regressor_ranking.csv"</span><span class="p">))</span>
<span class="n">ranking_lfr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Unnamed: 0</th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience_fair</th>
<th>fitness_education_fair</th>
<th>fitness_skills_fair</th>
<th>score_fair</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>637</td>
<td>0.386656</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0.059854</td>
<td>-0.032365</td>
<td>0.261145</td>
<td>0.360859</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1</td>
<td>1</td>
<td>581</td>
<td>0.386656</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.026629</td>
<td>-0.083227</td>
<td>0.201140</td>
<td>0.354947</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>2</td>
<td>1</td>
<td>2115</td>
<td>0.386656</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.362015</td>
<td>-0.095248</td>
<td>0.327542</td>
<td>0.920310</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1</td>
<td>685</td>
<td>0.386656</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.313101</td>
<td>-0.386881</td>
<td>-0.213363</td>
<td>0.359831</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>4</td>
<td>1</td>
<td>2111</td>
<td>0.386656</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0.193390</td>
<td>0.145650</td>
<td>0.463698</td>
<td>0.284195</td>
<td>5</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>1017</th>
<td>1017</td>
<td>5</td>
<td>114</td>
<td>-1.713231</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>-0.561324</td>
<td>-0.401285</td>
<td>-0.990056</td>
<td>-1.483876</td>
<td>94</td>
</tr>
<tr>
<th>1018</th>
<td>1018</td>
<td>5</td>
<td>122</td>
<td>-1.713231</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.543995</td>
<td>-0.401133</td>
<td>-0.991346</td>
<td>-1.633038</td>
<td>95</td>
</tr>
<tr>
<th>1019</th>
<td>1019</td>
<td>5</td>
<td>141</td>
<td>-1.713231</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>-0.528070</td>
<td>-0.392765</td>
<td>-0.990892</td>
<td>-1.755973</td>
<td>96</td>
</tr>
<tr>
<th>1020</th>
<td>1020</td>
<td>5</td>
<td>1144</td>
<td>-1.713231</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.488844</td>
<td>-0.309007</td>
<td>-0.836477</td>
<td>-1.659841</td>
<td>97</td>
</tr>
<tr>
<th>1021</th>
<td>1021</td>
<td>5</td>
<td>292</td>
<td>-2.000443</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>-0.507688</td>
<td>-0.396315</td>
<td>-1.002412</td>
<td>-1.929352</td>
<td>98</td>
</tr>
</tbody>
</table>
<p>1022 rows × 12 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display top-10 candidates from the ranked list for an example job title</span>
<span class="n">job_id</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">transformed_data_test_job</span> <span class="o">=</span> <span class="n">transformed_data_test</span><span class="p">[</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">query_col_data</span><span class="p">]</span> <span class="o">==</span> <span class="n">job_id</span><span class="p">]</span>
<span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test_job</span><span class="p">[</span><span class="n">columns_display_regressor</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>11</td>
<td>-0.091853</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.351388</td>
<td>4.076398</td>
<td>-0.136073</td>
<td>0.138767</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>3</td>
<td>184</td>
<td>-0.091853</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.947274</td>
<td>0.420530</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>1204</td>
<td>-0.091853</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>0.390341</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1108</td>
<td>-0.091853</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>1.371479</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>3</td>
<td>1441</td>
<td>-0.091853</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.351388</td>
<td>4.076398</td>
<td>0.405601</td>
<td>-0.213436</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>3</td>
<td>1092</td>
<td>-0.091853</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>0.843174</td>
<td>6</td>
</tr>
<tr>
<th>6</th>
<td>3</td>
<td>1472</td>
<td>-0.091853</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>-0.351388</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>0.843174</td>
<td>7</td>
</tr>
<tr>
<th>7</th>
<td>3</td>
<td>963</td>
<td>-0.091853</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.136073</td>
<td>1.296007</td>
<td>8</td>
</tr>
<tr>
<th>8</th>
<td>3</td>
<td>1489</td>
<td>-0.091853</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.351388</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>0.373570</td>
<td>9</td>
</tr>
<tr>
<th>9</th>
<td>3</td>
<td>1542</td>
<td>-0.091853</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.351388</td>
<td>4.076398</td>
<td>0.947274</td>
<td>0.994119</td>
<td>10</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>iFair Pipeline</strong></p>
<p>Apply the iFair pre-processing intervention. iFair aims at achieving individual fairness by creating representations that encourage similar outcomes for similar individuals regardless of the sensitive attributes, while also ensuring a good encoding of useful information (which aims at preserving the utility of the ranking).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the parameters of the pre-processing fairness intervention model</span>
<a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_iFair.html#findhr.fairness.fairness_method_iFair.iFair" title="findhr.fairness.fairness_method_iFair.iFair"><span class="n">fair_model</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_iFair.html#findhr.fairness.fairness_method_iFair.iFair" title="findhr.fairness.fairness_method_iFair.iFair"><span class="n">iFair</span></a><span class="p">(</span><span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">sensitive_col_data</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">features_col_data</span><span class="p">,</span>
                   <span class="n">score_col</span><span class="o">=</span><span class="n">score_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">A_x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">A_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">model_occ</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define pipeline for the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">'fitness_value'</span><span class="p">,</span> <span class="n">pipeline_derived</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"column_preprocessor_numerical_pandas"</span><span class="p">,</span> <span class="n">column_preprocessor_numerical_pandas</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"fair_preprocessing"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_iFair.html#findhr.fairness.fairness_method_iFair.iFair" title="findhr.fairness.fairness_method_iFair.iFair"><span class="n">fair_model</span></a><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-4"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                       __class__=&lt;class 'findhr.fairness.fairness_method_iFair.iFair'&gt;,
                       feature_cols=['fitness_experience', 'fitness_education',
                                     'fitness_skills'],
                       k=10, model_occ=True, name='iFair',
                       out_path='../../../data/fairness_output/',
                       pos_th=-2.864961693786468, print_interval=1000,
                       query_col='id_j', score_col='score',
                       sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                       verbose=True))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-33"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link">i<span>Not fitted</span></span></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                       __class__=&lt;class 'findhr.fairness.fairness_method_iFair.iFair'&gt;,
                       feature_cols=['fitness_experience', 'fitness_education',
                                     'fitness_skills'],
                       k=10, model_occ=True, name='iFair',
                       out_path='../../../data/fairness_output/',
                       pos_th=-2.864961693786468, print_interval=1000,
                       query_col='id_j', score_col='score',
                       sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                       verbose=True))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-34"><div><div>fitness_value: Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for fitness_value: Pipeline</span></a></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('init',
                 AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'ty...
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                      output_cols=('fitness_gender',)),
                                         (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                                      'skills_c'),
                                                                                                          metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                          output_cols=('fitness_skills',))})),
                ('end', DetachMetadata())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-35"><div><div>AttachMetadata</div></div></label><div class="sk-toggleable__content"><pre>AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties...
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'shortlisted':
    SCHEMA = {'type': 'integer'}
    ATTR_TYPE = category
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'skills_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                              'skills_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-36"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('professional_experience_c', 'experience_reqs_role_j'), ('relevant_exp_role_c',)): RelevantExperienceForRole(input_cols=('professional_experience_c',
                                                                                                                                                   'experience_reqs_role_j'),
                                                                                                                                       metadata_dict={'relevant_exp_role_c': {'experience_reqs_role_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                                                                                                                                                                              'professional_experience_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'role': {'type': 'string'}, 'duration': {'type': 'string'}}}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None}},
                                                                                                                                       output_cols=('relevant_exp_role_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-37"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('education_background_c',), ('degree_list_c',)): ExtractListOfProperty(input_cols=('education_background_c',),
                                                                                                 metadata_dict={'degree_list_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                 output_cols=('degree_list_c',)),
                        (('relevant_exp_role_c',), ('role_duration_months_c',)): ExtractMonthDurationJob(input_cols=('relevant_exp_role_c',),
                                                                                                         metadata_dict={'role_duration_months_c':
    SCHEMA = {'type': 'number', 'minimum': 0}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                         output_cols=('role_duration_months_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-38"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('agg_perceived_foreign_j', 'agg_perceived_foreign_c'), ('fitness_foreign',)): MatchBinary(input_cols=('agg_perceived_foreign_j',
                                                                                                                                'agg_perceived_foreign_c'),
                                                                                                                    metadata_dict={'fitness_foreign':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                                    output_cols=('fitness_foreign',)),
                        (('education_reqs_j', 'edu...
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                     output_cols=('fitness_gender',)),
                        (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                     'skills_c'),
                                                                                         metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                         output_cols=('fitness_skills',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-39"><div><div>DetachMetadata</div></div></label><div class="sk-toggleable__content"><pre>DetachMetadata()</pre></div> </div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-40"><div><div>column_preprocessor_numerical_pandas: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor_numerical_pandas: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder='passthrough',
                  transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience', 'fitness_education',
                                  'fitness_skills', 'score'])],
                  verbose_feature_names_out=False)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-41"><div><div>num</div></div></label><div class="sk-toggleable__content"><pre>['fitness_experience', 'fitness_education', 'fitness_skills', 'score']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-42"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-43" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-43"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-44" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-44"><div><div>remainder</div></div></label><div class="sk-toggleable__content"><pre>['Unnamed: 0', 'id_c', 'education_background_c', 'professional_experience_c', 'skills_c', 'gender_c', 'agg_perceived_foreign_c', 'id_j', 'education_reqs_j', 'experience_reqs_role_j', 'experience_reqs_duration_j', 'skills_j', 'gender_j', 'agg_perceived_foreign_j', 'ranking', 'shortlisted', 'gender_c_agg_perceived_foreign_c', 'relevant_exp_role_c', 'role_duration_months_c', 'degree_list_c', 'fitness_gender', 'fitness_foreign']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-45" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-45"><div><div>passthrough</div></div></label><div class="sk-toggleable__content"><pre>passthrough</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-46" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-46"><div><div>iFair</div></div></label><div class="sk-toggleable__content"><pre>iFair(A_x=0.01, A_z=1,
      __class__=&lt;class 'findhr.fairness.fairness_method_iFair.iFair'&gt;,
      feature_cols=['fitness_experience', 'fitness_education',
                    'fitness_skills'],
      k=10, model_occ=True, name='iFair',
      out_path='../../../data/fairness_output/', pos_th=-2.864961693786468,
      print_interval=1000, query_col='id_j', score_col='score',
      sensitive_col=['gender_c', 'agg_perceived_foreign_c'], verbose=True)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply transformation using the pre-processing fairness intervention model</span>
<span class="c1"># set the file_name if you want to save the data</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"train"</span>
<span class="n">transformed_data_train</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="n">transformed_data_test</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define regressor pipeline</span>
<span class="n">pipeline_regr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"column_preprocessor"</span><span class="p">,</span> <span class="n">column_preprocessor_fair_regressor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"regressor"</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
       <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the regressor</span>
<span class="n">pipeline_regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_data_train</span><span class="p">,</span> <span class="n">transformed_data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'score_fair'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-5 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-5"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-47" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-47"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-48" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-48"><div><div>column_preprocessor: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience_fair',
                                  'fitness_education_fair',
                                  'fitness_skills_fair', 'score_fair'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-49" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-49"><div><div>num</div></div></label><div class="sk-toggleable__content fitted"><pre>['fitness_experience_fair', 'fitness_education_fair', 'fitness_skills_fair', 'score_fair']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-50" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-50"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-51" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-51"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-52"><div><div>DecisionTreeRegressor</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeRegressor.html" rel="noreferrer" target="_blank">?<span>Documentation for DecisionTreeRegressor</span></a></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeRegressor(max_depth=3)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get predictions of regressor</span>
<span class="n">transformed_data_test</span><span class="p">[</span><span class="s1">'prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the generated ranking and the output of the pre-processing fairness intervention (columns with "_fair")</span>
<span class="n">ranking_ifair</span> <span class="o">=</span> <span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">columns_display_fairness</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"iFair"</span><span class="p">,</span><span class="s2">"iFair_regressor_ranking.csv"</span><span class="p">))</span>
<span class="n">ranking_ifair</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Unnamed: 0</th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience_fair</th>
<th>fitness_education_fair</th>
<th>fitness_skills_fair</th>
<th>score_fair</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2164</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.094002</td>
<td>0.221332</td>
<td>0.772306</td>
<td>1.254440</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1</td>
<td>1</td>
<td>657</td>
<td>1.331989</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.405618</td>
<td>-0.239528</td>
<td>1.927043</td>
<td>1.194877</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>2</td>
<td>1</td>
<td>2115</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>-0.866697</td>
<td>-0.636016</td>
<td>2.842281</td>
<td>1.206819</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1</td>
<td>607</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>-0.443405</td>
<td>-0.255196</td>
<td>1.933141</td>
<td>1.215071</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>4</td>
<td>1</td>
<td>524</td>
<td>1.331989</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>-0.535868</td>
<td>-0.383516</td>
<td>2.452338</td>
<td>1.059333</td>
<td>5</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>1017</th>
<td>1017</td>
<td>5</td>
<td>241</td>
<td>-2.130114</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1.885414</td>
<td>3.401496</td>
<td>0.264743</td>
<td>-2.029143</td>
<td>94</td>
</tr>
<tr>
<th>1018</th>
<td>1018</td>
<td>5</td>
<td>1668</td>
<td>-2.130114</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1.882563</td>
<td>3.354215</td>
<td>0.253995</td>
<td>-2.176396</td>
<td>95</td>
</tr>
<tr>
<th>1019</th>
<td>1019</td>
<td>5</td>
<td>122</td>
<td>-2.130114</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>1.883567</td>
<td>3.359600</td>
<td>0.255120</td>
<td>-2.165303</td>
<td>96</td>
</tr>
<tr>
<th>1020</th>
<td>1020</td>
<td>5</td>
<td>248</td>
<td>-2.130114</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>1.885986</td>
<td>3.376122</td>
<td>0.258665</td>
<td>-2.125746</td>
<td>97</td>
</tr>
<tr>
<th>1021</th>
<td>1021</td>
<td>5</td>
<td>292</td>
<td>-2.130114</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>1.813865</td>
<td>3.190090</td>
<td>0.237203</td>
<td>-2.170039</td>
<td>98</td>
</tr>
</tbody>
</table>
<p>1022 rows × 12 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display top-10 candidates from the ranked list for an example job title</span>
<span class="n">job_id</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">transformed_data_test_job</span> <span class="o">=</span> <span class="n">transformed_data_test</span><span class="p">[</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">query_col_data</span><span class="p">]</span> <span class="o">==</span> <span class="n">job_id</span><span class="p">]</span>
<span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test_job</span><span class="p">[</span><span class="n">columns_display_regressor</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>1571</td>
<td>1.331989</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>1.899785</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>3</td>
<td>144</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.405601</td>
<td>0.314869</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>963</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.136073</td>
<td>1.296007</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1108</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>1.371479</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>3</td>
<td>807</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>1.488948</td>
<td>-0.213436</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>3</td>
<td>1274</td>
<td>1.331989</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>2.845857</td>
<td>4.076398</td>
<td>2.030621</td>
<td>0.088453</td>
<td>6</td>
</tr>
<tr>
<th>6</th>
<td>3</td>
<td>184</td>
<td>1.331989</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.947274</td>
<td>0.420530</td>
<td>7</td>
</tr>
<tr>
<th>7</th>
<td>3</td>
<td>148</td>
<td>1.331989</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>1.899785</td>
<td>8</td>
</tr>
<tr>
<th>8</th>
<td>3</td>
<td>994</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.405601</td>
<td>0.350090</td>
<td>9</td>
</tr>
<tr>
<th>9</th>
<td>3</td>
<td>1983</td>
<td>1.331989</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.947274</td>
<td>0.127406</td>
<td>10</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>gFair Pipeline</strong></p>
<p>Apply the gFair pre-processing intervention. gFair aims at achieving group fairness by creating representations that encourage similar outcomes between similar individuals from different groups regardless of the sensitive attributes, while also ensuring a good encoding of useful information (which aims at preserving the utility of the ranking). Moreover, it aims at keeping the distance between individuals from the same group similar in the new space.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the optimisation type</span>
<span class="c1"># This example is run using the pairwise optimisation</span>
<span class="c1"># optimisation_type = {"pairwise": "all"} # pairwise comparison between all intersectional groups during the optimisation</span>
<span class="c1"># optimisation_type = {"independent": "all"} # the default value, which optimizes for each sensitive attribute independently</span>
<span class="c1"># optimisation_type = {"control": "ManNo"} # compares during the optimisation with the specified control value</span>
<span class="n">optimisation_type</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"extremes"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"ManNo"</span><span class="p">,</span> <span class="s2">"WomanYes"</span><span class="p">]}</span> <span class="c1"># compares during the optimisation only the defined values</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the parameters of the pre-processing fairness intervention model</span>
<a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_gFair.html#findhr.fairness.fairness_method_gFair.gFair" title="findhr.fairness.fairness_method_gFair.gFair"><span class="n">fair_model</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_gFair.html#findhr.fairness.fairness_method_gFair.gFair" title="findhr.fairness.fairness_method_gFair.gFair"><span class="n">gFair</span></a><span class="p">(</span><span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">sensitive_col_data</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">features_col_data</span><span class="p">,</span>
                   <span class="n">score_col</span><span class="o">=</span><span class="n">score_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">A_x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">A_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">A_igf</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">optimisation_type</span><span class="o">=</span><span class="n">optimisation_type</span><span class="p">,</span>
                   <span class="n">model_occ</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define pipeline for the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">'fitness_value'</span><span class="p">,</span> <span class="n">pipeline_derived</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"column_preprocessor_numerical_pandas"</span><span class="p">,</span> <span class="n">column_preprocessor_numerical_pandas</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"fair_preprocessing"</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../generated/findhr.fairness.fairness_method_gFair.html#findhr.fairness.fairness_method_gFair.gFair" title="findhr.fairness.fairness_method_gFair.gFair"><span class="n">fair_model</span></a><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the pre-processing fairness intervention model</span>
<span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-6 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-6"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                       feature_cols=['fitness_experience', 'fitness_education',
                                     'fitness_skills'],
                       k=10, model_occ=True, name='gFair',
                       optimisation_type={'extremes': ['ManNo', 'WomanYes']},
                       out_path='../../../data/fairness_output/',
                       pos_th=-2.864961693786468, print_interval=1000,
                       query_col='id_j', score_col='score',
                       sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                       verbose=True))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-53"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link">i<span>Not fitted</span></span></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('fitness_value',
                 Pipeline(steps=[('init',
                                  AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                                                'education_background_c':
    SC...
                       feature_cols=['fitness_experience', 'fitness_education',
                                     'fitness_skills'],
                       k=10, model_occ=True, name='gFair',
                       optimisation_type={'extremes': ['ManNo', 'WomanYes']},
                       out_path='../../../data/fairness_output/',
                       pos_th=-2.864961693786468, print_interval=1000,
                       query_col='id_j', score_col='score',
                       sensitive_col=['gender_c', 'agg_perceived_foreign_c'],
                       verbose=True))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-54"><div><div>fitness_value: Pipeline</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for fitness_value: Pipeline</span></a></div></label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('init',
                 AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                                               'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'ty...
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                      output_cols=('fitness_gender',)),
                                         (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                                      'skills_c'),
                                                                                                          metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                          output_cols=('fitness_skills',))})),
                ('end', DetachMetadata())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-55"><div><div>AttachMetadata</div></div></label><div class="sk-toggleable__content"><pre>AttachMetadata(metadata_dict={'agg_perceived_foreign_c':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'agg_perceived_foreign_j':
    SCHEMA = {'enum': ['No', 'Yes', 'Any']}
    ATTR_TYPE = category
    ATTR_USAGE = sensitive
    KNOWLEDGE_BASE = None,
                              'education_background_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties...
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'shortlisted':
    SCHEMA = {'type': 'integer'}
    ATTR_TYPE = category
    ATTR_USAGE = target
    KNOWLEDGE_BASE = None,
                              'skills_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                              'skills_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-56"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('professional_experience_c', 'experience_reqs_role_j'), ('relevant_exp_role_c',)): RelevantExperienceForRole(input_cols=('professional_experience_c',
                                                                                                                                                   'experience_reqs_role_j'),
                                                                                                                                       metadata_dict={'relevant_exp_role_c': {'experience_reqs_role_j':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None,
                                                                                                                                                                              'professional_experience_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'object', 'properties': {'institution': {'type': 'string'}, 'end_date': {'type': 'string'}, 'role': {'type': 'string'}, 'duration': {'type': 'string'}}}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None}},
                                                                                                                                       output_cols=('relevant_exp_role_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-57"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('education_background_c',), ('degree_list_c',)): ExtractListOfProperty(input_cols=('education_background_c',),
                                                                                                 metadata_dict={'degree_list_c':
    SCHEMA = {'type': 'array', 'items': {'type': 'string'}}
    ATTR_TYPE = object
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                 output_cols=('degree_list_c',)),
                        (('relevant_exp_role_c',), ('role_duration_months_c',)): ExtractMonthDurationJob(input_cols=('relevant_exp_role_c',),
                                                                                                         metadata_dict={'role_duration_months_c':
    SCHEMA = {'type': 'number', 'minimum': 0}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                         output_cols=('role_duration_months_c',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-58"><div><div>DerivedColumn</div></div></label><div class="sk-toggleable__content"><pre>DerivedColumn(mappings={(('agg_perceived_foreign_j', 'agg_perceived_foreign_c'), ('fitness_foreign',)): MatchBinary(input_cols=('agg_perceived_foreign_j',
                                                                                                                                'agg_perceived_foreign_c'),
                                                                                                                    metadata_dict={'fitness_foreign':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                                                    output_cols=('fitness_foreign',)),
                        (('education_reqs_j', 'edu...
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                     output_cols=('fitness_gender',)),
                        (('skills_j', 'skills_c'), ('fitness_skills',)): MatchFeatureSet(input_cols=('skills_j',
                                                                                                     'skills_c'),
                                                                                         metadata_dict={'fitness_skills':
    SCHEMA = {'type': 'number'}
    ATTR_TYPE = numeric
    ATTR_USAGE = default
    KNOWLEDGE_BASE = None},
                                                                                         output_cols=('fitness_skills',))})</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-59"><div><div>DetachMetadata</div></div></label><div class="sk-toggleable__content"><pre>DetachMetadata()</pre></div> </div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-60"><div><div>column_preprocessor_numerical_pandas: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor_numerical_pandas: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder='passthrough',
                  transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience', 'fitness_education',
                                  'fitness_skills', 'score'])],
                  verbose_feature_names_out=False)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-61" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-61"><div><div>num</div></div></label><div class="sk-toggleable__content"><pre>['fitness_experience', 'fitness_education', 'fitness_skills', 'score']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-62" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-62"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-63" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-63"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-64" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-64"><div><div>remainder</div></div></label><div class="sk-toggleable__content"><pre>['Unnamed: 0', 'id_c', 'education_background_c', 'professional_experience_c', 'skills_c', 'gender_c', 'agg_perceived_foreign_c', 'id_j', 'education_reqs_j', 'experience_reqs_role_j', 'experience_reqs_duration_j', 'skills_j', 'gender_j', 'agg_perceived_foreign_j', 'ranking', 'shortlisted', 'gender_c_agg_perceived_foreign_c', 'relevant_exp_role_c', 'role_duration_months_c', 'degree_list_c', 'fitness_gender', 'fitness_foreign']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-65" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-65"><div><div>passthrough</div></div></label><div class="sk-toggleable__content"><pre>passthrough</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-66" type="checkbox"/><label class="sk-toggleable__label sk-toggleable__label-arrow" for="sk-estimator-id-66"><div><div>gFair</div></div></label><div class="sk-toggleable__content"><pre>gFair(A_igf=0.01, A_x=0.01, A_z=1,
      __class__=&lt;class 'findhr.fairness.fairness_method_gFair.gFair'&gt;,
      feature_cols=['fitness_experience', 'fitness_education',
                    'fitness_skills'],
      k=10, model_occ=True, name='gFair',
      optimisation_type={'extremes': ['ManNo', 'WomanYes']},
      out_path='../../../data/fairness_output/', pos_th=-2.864961693786468,
      print_interval=1000, query_col='id_j', score_col='score',
      sensitive_col=['gender_c', 'agg_perceived_foreign_c'], verbose=True)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply transformation using the pre-processing fairness intervention model</span>
<span class="c1"># set the file_name if you want to save the data</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"train"</span>
<span class="n">transformed_data_train</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_train</span><span class="p">)</span>
<span class="n">fair_model</span><span class="o">.</span><span class="n">configs</span><span class="p">[</span><span class="s2">"file_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="n">transformed_data_test</span> <span class="o">=</span> <span class="n">pipeline_tranform_data</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_all_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define regressor pipeline</span>
<span class="n">pipeline_regr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"column_preprocessor"</span><span class="p">,</span> <span class="n">column_preprocessor_fair_regressor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"regressor"</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
       <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit the regressor</span>
<span class="n">pipeline_regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_data_train</span><span class="p">,</span> <span class="n">transformed_data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'score_fair'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>#sk-container-id-7 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-7 {
  color: var(--sklearn-color-text);
}

#sk-container-id-7 pre {
  padding: 0;
}

#sk-container-id-7 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-7 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-7 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-7 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-7 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-7 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-7 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-7 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-7 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-7 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-7 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-7 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-7 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-7 div.sk-label label.sk-toggleable__label,
#sk-container-id-7 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-7 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-7 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-7 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-7 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-7 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-7 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-7 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-7 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-7 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div class="sk-top-container" id="sk-container-id-7"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br/>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-67" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-67"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html" rel="noreferrer" target="_blank">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('column_preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['fitness_experience_fair',
                                                   'fitness_education_fair',
                                                   'fitness_skills_fair',
                                                   'score_fair'])])),
                ('regressor', DecisionTreeRegressor(max_depth=3))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-68" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-68"><div><div>column_preprocessor: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noreferrer" target="_blank">?<span>Documentation for column_preprocessor: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['fitness_experience_fair',
                                  'fitness_education_fair',
                                  'fitness_skills_fair', 'score_fair'])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-69" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-69"><div><div>num</div></div></label><div class="sk-toggleable__content fitted"><pre>['fitness_experience_fair', 'fitness_education_fair', 'fitness_skills_fair', 'score_fair']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-70" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-70"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html" rel="noreferrer" target="_blank">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy='median')</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-71" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-71"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noreferrer" target="_blank">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-72" type="checkbox"/><label class="sk-toggleable__label fitted sk-toggleable__label-arrow" for="sk-estimator-id-72"><div><div>DecisionTreeRegressor</div></div><div><a class="sk-estimator-doc-link fitted" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeRegressor.html" rel="noreferrer" target="_blank">?<span>Documentation for DecisionTreeRegressor</span></a></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeRegressor(max_depth=3)</pre></div> </div></div></div></div></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get predictions of regressor</span>
<span class="n">transformed_data_test</span><span class="p">[</span><span class="s1">'prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the generated ranking and the output of the pre-processing fairness intervention (columns with "_fair")</span>
<span class="n">ranking_gfair</span> <span class="o">=</span> <span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">columns_display_fairness</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">"gFair"</span><span class="p">,</span><span class="s2">"gFair_regressor_ranking.csv"</span><span class="p">))</span>
<span class="n">ranking_gfair</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Unnamed: 0</th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience_fair</th>
<th>fitness_education_fair</th>
<th>fitness_skills_fair</th>
<th>score_fair</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0</td>
<td>1</td>
<td>2115</td>
<td>1.624587</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.675372</td>
<td>0.046379</td>
<td>0.194812</td>
<td>1.623185</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1</td>
<td>1</td>
<td>2164</td>
<td>1.624587</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.662174</td>
<td>0.019614</td>
<td>0.152438</td>
<td>1.659884</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>2</td>
<td>1</td>
<td>584</td>
<td>1.624587</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>0.635050</td>
<td>0.146856</td>
<td>0.223275</td>
<td>1.487441</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>1</td>
<td>657</td>
<td>1.624587</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0.670256</td>
<td>0.014165</td>
<td>0.166988</td>
<td>1.654061</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>4</td>
<td>1</td>
<td>607</td>
<td>1.624587</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>0.684900</td>
<td>-0.014060</td>
<td>0.153312</td>
<td>1.709260</td>
<td>5</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>1017</th>
<td>1017</td>
<td>5</td>
<td>114</td>
<td>-0.996676</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1.122489</td>
<td>0.465378</td>
<td>0.449004</td>
<td>-0.950135</td>
<td>94</td>
</tr>
<tr>
<th>1018</th>
<td>1018</td>
<td>5</td>
<td>241</td>
<td>-0.996676</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1.110529</td>
<td>0.464717</td>
<td>0.450269</td>
<td>-0.921371</td>
<td>95</td>
</tr>
<tr>
<th>1019</th>
<td>1019</td>
<td>5</td>
<td>122</td>
<td>-0.996676</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>1.085116</td>
<td>0.452203</td>
<td>0.461799</td>
<td>-0.866779</td>
<td>96</td>
</tr>
<tr>
<th>1020</th>
<td>1020</td>
<td>5</td>
<td>141</td>
<td>-0.996676</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>1.172857</td>
<td>0.468795</td>
<td>0.443004</td>
<td>-1.073362</td>
<td>97</td>
</tr>
<tr>
<th>1021</th>
<td>1021</td>
<td>5</td>
<td>86</td>
<td>-0.996676</td>
<td>WomanNo</td>
<td>Woman</td>
<td>No</td>
<td>0.987708</td>
<td>0.449640</td>
<td>0.468082</td>
<td>-0.649134</td>
<td>98</td>
</tr>
</tbody>
</table>
<p>1022 rows × 12 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display top-10 candidates from the ranked list for an example job title</span>
<span class="n">job_id</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">transformed_data_test_job</span> <span class="o">=</span> <span class="n">transformed_data_test</span><span class="p">[</span><span class="n">transformed_data_test</span><span class="p">[</span><span class="n">query_col_data</span><span class="p">]</span> <span class="o">==</span> <span class="n">job_id</span><span class="p">]</span>
<span class="n">generate_ranking</span><span class="p">(</span><span class="n">transformed_data_test_job</span><span class="p">[</span><span class="n">columns_display_regressor</span><span class="p">],</span> <span class="n">query_col</span><span class="o">=</span><span class="n">query_col_data</span><span class="p">,</span> <span class="n">score_col</span><span class="o">=</span><span class="s1">'prediction'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rank_col</span><span class="o">=</span><span class="s1">'rank'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>id_j</th>
<th>id_c</th>
<th>prediction</th>
<th>gender_c_agg_perceived_foreign_c</th>
<th>gender_c</th>
<th>agg_perceived_foreign_c</th>
<th>fitness_experience</th>
<th>fitness_education</th>
<th>fitness_skills</th>
<th>score</th>
<th>rank</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3</td>
<td>1104</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>0.209208</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>3</td>
<td>807</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>1.488948</td>
<td>-0.213436</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>819</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>-0.213436</td>
<td>3</td>
</tr>
<tr>
<th>3</th>
<td>3</td>
<td>888</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>-0.213436</td>
<td>4</td>
</tr>
<tr>
<th>4</th>
<td>3</td>
<td>963</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.136073</td>
<td>1.296007</td>
<td>5</td>
</tr>
<tr>
<th>5</th>
<td>3</td>
<td>994</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>0.405601</td>
<td>0.350090</td>
<td>6</td>
</tr>
<tr>
<th>6</th>
<td>3</td>
<td>1092</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>0.843174</td>
<td>7</td>
</tr>
<tr>
<th>7</th>
<td>3</td>
<td>15</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.136073</td>
<td>-0.102214</td>
<td>8</td>
</tr>
<tr>
<th>8</th>
<td>3</td>
<td>1108</td>
<td>0.859914</td>
<td>ManNo</td>
<td>Man</td>
<td>No</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-1.219419</td>
<td>1.371479</td>
<td>9</td>
</tr>
<tr>
<th>9</th>
<td>3</td>
<td>1204</td>
<td>0.859914</td>
<td>ManYes</td>
<td>Man</td>
<td>Yes</td>
<td>2.845857</td>
<td>4.076398</td>
<td>-0.677746</td>
<td>0.390341</td>
<td>10</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<section id="Plot-Data-Distribution-Top-k">
<h3>Plot Data Distribution Top-k<a class="headerlink" href="#Plot-Data-Distribution-Top-k" title="Link to this heading"></a></h3>
<p>Plot the data distribution of top-k with and without the fairness intervention to visualize the impact on increasing the procentage of the protected groups in top-k (y-axis) across the jobs (x-axis).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[243]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_dist_top_k</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">query_col</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="c1"># filter to top-k ranks</span>
    <span class="n">top_k</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'rank'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">]</span>

    <span class="c1"># count how often each s_col appears in top-k per query_col</span>
    <span class="n">count_top_k</span> <span class="o">=</span> <span class="n">top_k</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">query_col</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'count'</span><span class="p">)</span>
    <span class="n">count_top_k</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_top_k</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span><span class="o">/</span><span class="n">k</span>

    <span class="n">pivot_df</span> <span class="o">=</span> <span class="n">count_top_k</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">query_col</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sensitive_col</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">'count'</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">pivot_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Count in Top-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Distribution of </span><span class="si">{</span><span class="n">sensitive_col</span><span class="si">}</span><span class="s1"> in Top-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1"> ranking'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">sensitive_col</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[244]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># original ranking</span>
<span class="n">plot_dist_top_k</span><span class="p">(</span><span class="n">ranking_original</span><span class="p">,</span> <span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">intersectional_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">"original"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_Example_FairPreprocessingRanking_68_0.png" src="../_images/example_notebooks_Example_FairPreprocessingRanking_68_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[245]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lfr model</span>
<span class="n">plot_dist_top_k</span><span class="p">(</span><span class="n">ranking_lfr</span><span class="p">,</span> <span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">intersectional_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">"LFR"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_Example_FairPreprocessingRanking_69_0.png" src="../_images/example_notebooks_Example_FairPreprocessingRanking_69_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[246]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># iFair model</span>
<span class="n">plot_dist_top_k</span><span class="p">(</span><span class="n">ranking_ifair</span><span class="p">,</span> <span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">intersectional_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">"iFair"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_Example_FairPreprocessingRanking_70_0.png" src="../_images/example_notebooks_Example_FairPreprocessingRanking_70_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[247]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># gFair Model</span>
<span class="n">plot_dist_top_k</span><span class="p">(</span><span class="n">ranking_gfair</span><span class="p">,</span> <span class="n">query_col_data</span><span class="p">,</span> <span class="n">sensitive_col</span><span class="o">=</span><span class="n">intersectional_col_data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">"gFair"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_Example_FairPreprocessingRanking_71_0.png" src="../_images/example_notebooks_Example_FairPreprocessingRanking_71_0.png"/>
</div>
</div>
</section>
</section>
</section>
</div>
</div>
<footer>
<hr/>
<div role="contentinfo">
<p>© Copyright 2024, findhr project.</p>
</div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>